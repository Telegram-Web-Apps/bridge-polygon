!function(){"use strict";function e(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var t=function(){function t(){this.listeners={},this.globalListeners=[]}return t.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.globalListeners.forEach((function(r){return r.apply(void 0,e([t],n,!1))}));var i=this.listeners[t];void 0!==i&&i.forEach((function(e){return e.apply(void 0,n)}))},t.prototype.emitUnsafe=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.emit.apply(this,e([t],n,!1))},t.prototype.on=function(e,t){var n=this.listeners[e];void 0===n?this.listeners[e]=[t]:n.push(t)},t.prototype.off=function(e,t){var n=this.listeners[e];if(void 0!==n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}},t.prototype.subscribe=function(e){this.globalListeners.push(e)},t.prototype.unsubscribe=function(e){var t=this.globalListeners.indexOf(e);t>=0&&this.globalListeners.splice(t,1)},t}();function n(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var r=function(e){if("number"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as number'));return e},i=function(e){if("string"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as string'));return e},o=function(e){if("boolean"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as boolean'));return e};function a(e,t){return function(r){if(null==r){if(void 0===t)throw new TypeError("Value is empty.");return t()}var i=r;if("string"==typeof i)try{i=JSON.parse(i)}catch(e){throw new TypeError("Value is not JSON object converted to string.")}if(!n(i))throw new TypeError("Value is not JSON object.");var o={};for(var a in e){var s=e[a],u=s[0],c=s[1];try{var l=c(i[u]);void 0!==l&&(o[a]=l)}catch(e){throw new Error('Unable to parse parameter "'.concat(u,'"'),{cause:e})}}return o}}function s(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=new Date,o=Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(i),a=i.getMilliseconds().toString();console[t].apply(console,e(["[".concat(o,".").concat("0".repeat(3-a.length)+a,"]")],n,!1))}var u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},u.apply(this,arguments)};function c(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var d,f=a({height:["height",r],width:["width",function(e){return void 0===e?null:r(e)}],is_state_stable:["is_state_stable",o],is_expanded:["is_expanded",o]}),p=a({theme_params:["theme_params",function(e){if(!n(e))throw new TypeError('Unable to parse "'.concat(e,'" as Record'));return e}]}),v=a({button_id:["button_id",function(e){return null==e?void 0:i(e)}]}),h=a({data:["data",function(e){return void 0===e?e:i(e)}]}),g=a({slug:["slug",i],status:["status",i]}),y=a({req_id:["req_id",i],data:["data",function(e){return null==e?e:i(e)}]}),b=a({type:["eventType",i],data:["eventData",function(e){return e}]});function w(e){if(void 0===e&&(e=!1),void 0===d){var r=new t,i=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e&&s.apply(void 0,l([t,"[Bridge]"],n,!1))};window.addEventListener("message",(function(e){var t;if(i("log","message event received",e),e instanceof MessageEvent){if(e.source!==window.parent||"string"!=typeof e.data)return i("log","event rejected",e);t=e.data}else{if(!(e instanceof CustomEvent&&n(e.detail)&&"string"==typeof e.detail.eventType&&"eventData"in e.detail))return i("warn","event was skipped",e);t=e.detail}try{var o=b(t),a=o.type,s=o.data;r.emit("message",a,s)}catch(e){i("error","event data extraction error",t,e)}})),window.addEventListener("resize",(function(){var e={width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0};r.emit("message","viewport_changed",e)})),d=r}return d}var m=!1;function _(e,t,n){if(void 0===t&&(t=""),void 0===n&&(n={}),function(){try{return window.self!==window.top}catch(e){return!0}}())return window.parent.postMessage(JSON.stringify({eventType:e,eventData:t}),n.targetOrigin||"https://web.telegram.org");if(function(e){return void 0!==e.TelegramWebviewProxy}(window))return window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));if(function(e){return"external"in e&&"function"==typeof e.external.notify}(window))return window.external.notify(JSON.stringify({eventType:e,eventData:t}));throw new Error("Unable to determine current environment and possible way to send event.")}var E=function(){function e(e){void 0===e&&(e={});var n=this;this._boundEmitter=null,this.ee=new t,this.emit=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];n.log.apply(n,l(["log","[emit]",e],r,!1)),(t=n.ee).emit.apply(t,l([e],r,!1))},this.emitUnsafe=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];n.log.apply(n,l(["log","[emitUnsafe]",e],r,!1)),(t=n.ee).emitUnsafe.apply(t,l([e],r,!1))},this.log=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];n.debug&&s.apply(void 0,l([e,"[Bridge]"],t,!1))},this.processEvent=function(e,t){n.log("log","[processEvent]",e,t);try{switch(e){case"viewport_changed":return n.emit(e,function(e){var t=f(e),n=t.width,r=c(t,["width"]);return u(u({},r),{width:null===n?window.innerWidth:n})}(t));case"theme_changed":return n.emit(e,p(t));case"popup_closed":return null==t?n.emit(e,{}):n.emit(e,v(t));case"set_custom_style":return n.emit(e,i(t));case"qr_text_received":return n.emit(e,h(t));case"main_button_pressed":case"back_button_pressed":case"settings_button_pressed":case"scan_qr_popup_closed":return n.emit(e);case"clipboard_text_received":return n.emit(e,y(t));case"invoice_closed":return n.emit(e,g(t));default:return n.emitUnsafe(e,t)}}catch(e){throw n.log("error","[processEvent] error",e),e}},this.on=this.ee.on.bind(this.ee),this.off=this.ee.off.bind(this.ee),this.postEvent=function(e,t,r){var i=r||{},o=i.targetOrigin,a=void 0===o?n.targetOrigin:o,s=c(i,["targetOrigin"]);_(e,t,u(u({},s),{targetOrigin:a})),n.log("log","[postEvent]",e,t)},this.subscribe=this.ee.subscribe.bind(this.ee),this.unsubscribe=this.ee.unsubscribe.bind(this.ee);var r=e.debug,o=void 0!==r&&r,a=e.emitter,d=void 0===a?null:a,b=e.targetOrigin,w=void 0===b?"https://web.telegram.org":b;this.debug=o,this.targetOrigin=w,this.boundEmitter=d}return Object.defineProperty(e.prototype,"boundEmitter",{get:function(){return this._boundEmitter||null},set:function(e){null!==this._boundEmitter&&this._boundEmitter.off("message",this.processEvent),this._boundEmitter=e,null!==this._boundEmitter&&this._boundEmitter.on("message",this.processEvent)},enumerable:!1,configurable:!0}),e.prototype.bind=function(e){this.boundEmitter=e},e.prototype.unbind=function(){this.boundEmitter=null},e}();var O=function(e){void 0===e&&(e={});var t=e.defineReceiver,n=void 0===t||t,r=e.emitter,i=void 0===r?w():r,o=c(e,["defineReceiver","emitter"]);return n&&function(e){if(void 0===e&&(e=!1),!m||e){var t=window;[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach((function(e){var n=t;e.forEach((function(e,t,r){t!==r.length-1?(e in n||(n[e]={}),n=n[e]):n[e]=function(e,t){window.dispatchEvent(new CustomEvent("message",{detail:{eventType:e,eventData:t}}))}}))})),m=!0}}(),new E(u(u({},o),{emitter:i}))}({debug:!0});window.bridge=O}();
